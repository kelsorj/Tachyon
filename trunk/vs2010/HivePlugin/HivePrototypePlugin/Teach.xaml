<UserControl x:Class="BioNex.HivePrototypePlugin.Teach"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:utils="clr-namespace:BioNex.Shared.Utils;assembly=Utils"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
    xmlns:local="clr-namespace:BioNex.HivePrototypePlugin"
    Height="Auto" Width="Auto" Background="Transparent">

    <UserControl.Resources>
        <x:Array x:Key="PlateOrientations" Type="sys:String">
            <sys:String>Landscape</sys:String>
            <sys:String>Portrait</sys:String>
        </x:Array>
        <Style x:Key="PositionStyle" TargetType="TextBox">
            <Setter Property="TextAlignment" Value="Right" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Background" Value="Black" />
            <Setter Property="Foreground" Value="Green" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Width" Value="100" />
            <Setter Property="IsReadOnly" Value="True" />
            <Setter Property="Margin" Value="3" />
        </Style>
        <Style x:Key="NewApproachHeightStyle" TargetType="TextBox">
            <Setter Property="TextAlignment" Value="Right" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Background" Value="White" />
            <Setter Property="Foreground" Value="Green" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Width" Value="100" />
            <Setter Property="IsReadOnly" Value="False" />
            <Setter Property="Margin" Value="3" />
        </Style>
        <Style TargetType="{x:Type Button}">
            <Setter Property="ToolTipService.ShowOnDisabled" Value="True" />
        </Style>
        <utils:StringFormatter x:Key="PositionFormatConverter" />
        <local:OrientationFormatter x:Key="OrientationFormatterConverter" />
        <!-- this is how you implement a sorted combobox with an observablecollection in codebehind-->
        <CollectionViewSource Source="{Binding Path=TeachpointNames}" x:Key="tps">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription />
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <GroupBox Grid.Column="0" BorderBrush="DarkOrange" Header="TeachpointPositions">
            <StackPanel Grid.Column="0" Orientation="Vertical" Height="Auto">
                <Label HorizontalContentAlignment="Center" Height="Auto">X:</Label>
                <TextBox Style="{StaticResource PositionStyle}" Text="{Binding TeachpointPosition.X, Converter={StaticResource PositionFormatConverter}, ConverterParameter='\{0:0.000\}'}" />
                <Label HorizontalContentAlignment="Center" Height="Auto">Y:</Label>
                <TextBox Style="{StaticResource PositionStyle}" Text="{Binding TeachpointPosition.Y, Converter={StaticResource PositionFormatConverter}, ConverterParameter='\{0:0.000\}'}" />
                <Label HorizontalContentAlignment="Center" Height="Auto">Z:</Label>
                <TextBox Style="{StaticResource PositionStyle}" Text="{Binding TeachpointPosition.Z, Converter={StaticResource PositionFormatConverter}, ConverterParameter='\{0:0.000\}'}" />
                <Label HorizontalContentAlignment="Center" Height="Auto">Approach height:</Label>
                <TextBox Style="{StaticResource PositionStyle}" Text="{Binding TeachpointPosition.ApproachHeight, Converter={StaticResource PositionFormatConverter}, ConverterParameter='\{0:0.000\}'}" />
                <Label HorizontalContentAlignment="Center" Height="Auto">Orientation:</Label>
                <TextBox Style="{StaticResource PositionStyle}" Text="{Binding TeachpointPosition.Orientation}" TextAlignment="Center" />
            </StackPanel>
        </GroupBox>        
        <!-- teachpoint properties -->
        <GroupBox Grid.Column="1" BorderBrush="DarkOrange" Header="Teachpoint Information">
            <Grid>
                <Grid.RowDefinitions>
                    <!-- select plate storage device -->
                    <RowDefinition Height="Auto" MinHeight="28" />
                    <!-- teachpoint filter string -->
                    <RowDefinition Height="Auto" MinHeight="28" />
                    <!-- select teachpoint -->
                    <RowDefinition Height="Auto" MinHeight="28" />
                    <!-- new approach height -->
                    <RowDefinition Height="Auto" MinHeight="33" />
                    <!-- labware -->
                    <RowDefinition Height="Auto" MinHeight="28" />
                    <!-- plate orientation -->
                    <RowDefinition Height="Auto" MinHeight="28" />
                    <!-- functions -->
                    <RowDefinition />
                    <!-- misc move functions -->
                    <RowDefinition Height="Auto" MinHeight="58" />
                    <!-- teachpoint functions-->
                    <RowDefinition MaxHeight="70"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="150" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <!-- select plate storage device -->
                <TextBlock Grid.Column="0" Grid.Row="0" HorizontalAlignment="Right" VerticalAlignment="Center">Select device:</TextBlock>
                <ComboBox Grid.Column="1" ItemsSource="{Binding AccessibleDeviceView}" IsSynchronizedWithCurrentItem="True" Margin="3" MinWidth="100" />
                <!-- enter filter string-->
                <TextBlock Grid.Column="0" Grid.Row="1" HorizontalAlignment="Right" VerticalAlignment="Center">Optional teachpoint filter:</TextBlock>
                <TextBox Grid.Column="1" Grid.Row="1" HorizontalAlignment="Stretch" VerticalAlignment="Center" Text="{Binding TeachpointFilter, UpdateSourceTrigger=PropertyChanged}" Margin="3"></TextBox>
                <!-- select teachpoint -->
                <TextBlock Grid.Column="0" Grid.Row="2" HorizontalAlignment="Right" VerticalAlignment="Center">Select Teachpoint:</TextBlock>
                <ComboBox Grid.Column="1" Grid.Row="2" ItemsSource="{Binding TeachpointNames}" IsSynchronizedWithCurrentItem="True" Margin="3" MinWidth="100">
                    <ComboBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <VirtualizingStackPanel />
                        </ItemsPanelTemplate>
                    </ComboBox.ItemsPanel>
                </ComboBox>
                <!-- approach height-->
                <TextBlock Grid.Column="0" Grid.Row="3" HorizontalAlignment="Right" VerticalAlignment="Center">New approach height:</TextBlock>
                <StackPanel Grid.Column="1" Grid.Row="3" Orientation="Horizontal">
                    <TextBox Style="{StaticResource NewApproachHeightStyle}" Text="{Binding NewApproachHeight, Mode=TwoWay}" />
                    <!--, Converter={StaticResource PositionFormatConverter}, ConverterParameter='\{0:0.000\}'}" /-->
                    <Button Margin="3" Command="{Binding UpdateApproachHeightCommand}" ToolTip="{Binding UpdateApproachHeightToolTip}">Update Approach Height Now</Button>
                </StackPanel>
                <!-- labware -->
                <Label Grid.Column="0" Grid.Row="4" HorizontalContentAlignment="Right" VerticalAlignment="Center">Labware:</Label>
                <ComboBox Grid.Column="1" Grid.Row="4" ItemsSource="{Binding LabwareNames}" SelectedItem="{Binding PickAndPlaceLabware, Mode=TwoWay}" Margin="3"></ComboBox>
                <!-- plate orientation -->
                <Label Grid.Column="0" Grid.Row="5" HorizontalContentAlignment="Right" VerticalAlignment="Center">Plate Orientation:</Label>
                <ComboBox Grid.Column="1" Grid.Row="5" Width="100" ItemsSource="{StaticResource PlateOrientations}" SelectedIndex="{Binding PlateOrientation, Converter={StaticResource OrientationFormatterConverter}, Mode=TwoWay}" HorizontalAlignment="Left" Margin="3"></ComboBox>
                <!-- functions -->
                <UniformGrid Grid.Row="6" Grid.ColumnSpan="2" Rows="2">
                    <Button Margin="3" Command="{Binding MoveToTeachpointCommand}" ToolTip="{Binding MoveToTeachpointToolTip}">Move to TP w/ Plate</Button>
                    <Button Margin="3" Command="{Binding SaveTeachpointCommand}" ToolTip="{Binding SaveTeachpointToolTip}">Save as New Teachpoint</Button>
                    <Button Margin="3" Command="{Binding UpdateTeachpointCommand}" ToolTip="{Binding UpdateTeachpointToolTip}">Update Teachpoint</Button>
                    <Button Margin="3" Command="{Binding ReteachTeachpointCommand}" Visibility="{Binding EngineeringTabVisibility}" ToolTip="Reteaches teachpoint with current position and approach height value, and offers a chance to offset all other teachpoints">Reteach all based on TP here</Button>
                </UniformGrid>
                <!-- jog controls moved here -->
                <GroupBox Grid.Row="7" Grid.ColumnSpan="2" Header="Jog Controls" BorderBrush="DarkOrange">
                    <Grid>
                        <!-- jog controls -->
                        <local:MiniJogControl />
                    </Grid>
                </GroupBox>


                <!-- teachpoint functions -->
                <GroupBox Grid.Row="8" Grid.ColumnSpan="2" Header="Teachpoint Functions" BorderBrush="DarkOrange">
                    <UniformGrid Rows="1">
                        <Button Margin="3" Command="{Binding ReloadTeachpointsCommand}">Reload File</Button>
                        <Button Margin="3" Command="{Binding TeachpointInterpolationCommand}" ToolTip="{Binding TeachpointInterpolationToolTip}">Interpolate</Button>
                        <Button Margin="3" Command="{Binding TransformTeachpointCommand}" ToolTip="{Binding TransformTeachpointToolTip}">Transform</Button>
                    </UniformGrid>
                </GroupBox>
            </Grid>
        </GroupBox>
        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <!-- pick and place testing -->
                <RowDefinition Height="Auto" />
                <!-- nudge tool (hidden) -->
                <RowDefinition />
            </Grid.RowDefinitions>
            <!-- PICK AND PLACE -->
            <GroupBox Grid.Row="0" Header="Pick and Place Testing" BorderBrush="DarkOrange">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"></RowDefinition>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition></ColumnDefinition>
                        <ColumnDefinition Width="100"></ColumnDefinition>
                        <ColumnDefinition></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <!-- teachpoint A & B functions -->
                    <GroupBox Grid.Column="0" Grid.Row="1" Header="Teachpoint A">
                        <StackPanel>
                            <Button Margin="3" Command="{Binding PickACommand}" ToolTip="{Binding ToolTipPickA}">
                                <Button.Content>
                                    <StackPanel Orientation="Vertical">
                                        <Image Source="Images/pick_a.png" Width="32" Stretch="Uniform" />
                                        <Label>Pick from A</Label>
                                    </StackPanel>
                                </Button.Content>
                            </Button>
                            <TextBlock>Device:</TextBlock>
                            <ComboBox Margin="3" ItemsSource="{Binding DeviceAView}" IsSynchronizedWithCurrentItem="True" />
                            <TextBlock>Filter:</TextBlock>
                            <TextBox Text="{Binding TeachpointAFilter, UpdateSourceTrigger=PropertyChanged}"></TextBox>
                            <TextBlock>Teachpoint:</TextBlock>
                            <ComboBox Margin="3" ItemsSource="{Binding TeachpointANames}" IsSynchronizedWithCurrentItem="True" />
                            <Button Margin="3" BorderThickness="0" Command="{Binding PlaceACommand}" ToolTip="{Binding ToolTipPlaceA}">
                                <Button.Content>
                                    <StackPanel Orientation="Vertical">
                                        <Image Source="Images/place_a.png" Width="32" Stretch="Uniform" />
                                        <Label>Place at A</Label>
                                    </StackPanel>
                                </Button.Content>
                            </Button>
                        </StackPanel>
                    </GroupBox>
                    <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center">
                        <Button Margin="3" Command="{Binding TransferABCommand}" ToolTip="{Binding ToolTipTransferAB}">
                            <Button.Content>
                                <StackPanel Orientation="Vertical">
                                    <Image Source="Images/right.png" Width="32" />
                                    <Label>A to B</Label>
                                </StackPanel>
                            </Button.Content>
                        </Button>
                        <Button Margin="3" Command="{Binding TransferBACommand}" ToolTip="{Binding ToolTipTransferBA}">
                            <Button.Content>
                                <StackPanel Orientation="Vertical">
                                    <Image Source="Images/left.png" Width="32" />
                                    <Label>B to A</Label>
                                </StackPanel>
                            </Button.Content>
                        </Button>
                    </StackPanel>
                    <GroupBox Grid.Column="2" Grid.Row="1" Header="Teachpoint B">
                        <StackPanel Background="LightSalmon">
                            <Button Margin="3" Command="{Binding PickBCommand}" ToolTip="{Binding ToolTipPickB}">
                                <Button.Content>
                                    <StackPanel Orientation="Vertical">
                                        <Image Source="Images/pick_b.png" Width="32" Stretch="Uniform" />
                                        <Label>Pick from B</Label>
                                    </StackPanel>
                                </Button.Content>
                            </Button>
                            <TextBlock>Device:</TextBlock>
                            <ComboBox Margin="3" ItemsSource="{Binding DeviceBView}" IsSynchronizedWithCurrentItem="True"/>
                            <TextBlock>Filter:</TextBlock>
                            <TextBox Text="{Binding TeachpointFilter, UpdateSourceTrigger=PropertyChanged}"></TextBox>
                            <TextBlock>Teachpoint:</TextBlock>
                            <ComboBox Margin="3" ItemsSource="{Binding TeachpointBNames}" IsSynchronizedWithCurrentItem="True" />
                            <Button Margin="3" Command="{Binding PlaceBCommand}" ToolTip="{Binding ToolTipPlaceB}">
                                <Button.Content>
                                    <StackPanel Orientation="Vertical">
                                        <Image Source="Images/place_b.png" Width="32" Stretch="Uniform" />
                                        <Label>Place at B</Label>
                                    </StackPanel>
                                </Button.Content>
                            </Button>
                        </StackPanel>
                    </GroupBox>
                </Grid>
            </GroupBox>
            <!-- nudge tool here -->
            <local:NudgeTool Grid.Row="1" Background="LightSalmon" />
        </Grid>
    </Grid>
</UserControl>
