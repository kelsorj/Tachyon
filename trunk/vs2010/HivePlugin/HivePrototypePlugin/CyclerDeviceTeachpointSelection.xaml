<UserControl x:Class="BioNex.HivePrototypePlugin.CyclerDeviceTeachpointSelection"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300">
    
    <Grid VerticalAlignment="Stretch">
        <Rectangle RadiusX="10" RadiusY="10" StrokeThickness="2" Stroke="Orange"></Rectangle>
        <DockPanel Margin="10">
            <!-- device selection and delete button -->
            <Grid DockPanel.Dock="Top">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="48" />
                </Grid.ColumnDefinitions>
                <GroupBox Grid.Column="0" Header="Device" BorderBrush="Orange">
                    <ComboBox Height="Auto" ItemsSource="{Binding DeviceNames}" IsSynchronizedWithCurrentItem="True" IsEnabled="{Binding Enabled}"></ComboBox>
                </GroupBox>
                <Button Grid.Column="1" Command="{Binding DeleteDeviceTeachpointsCommand}" IsEnabled="{Binding Enabled}">
                    <Button.Content>
                        <Grid>
                            <Image Source="Images/trashcan_full.png"></Image>
                            <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center">Delete</TextBlock>
                        </Grid>
                    </Button.Content>
                </Button>
            </Grid>
            <!-- select all teachpoints -->
            <Button Margin="6" DockPanel.Dock="Top" Command="{Binding SelectAllTeachpointsCommand}" IsEnabled="{Binding Enabled}">Select All Teachpoints</Button>
            <!-- teachpoint selection -->
            <GroupBox Header="Teachpoints" BorderBrush="Orange" DockPanel.Dock="Top">
                <ListBox SelectionMode="Extended" ItemsSource="{Binding TeachpointNames}" Width="Auto" IsEnabled="{Binding Enabled}">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="{x:Type ListBoxItem}">
                            <Setter Property="IsSelected" Value="{Binding Mode=TwoWay, Path=IsSelected}"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                        <Border x:Name="Bd" SnapsToDevicePixels="true" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="true">
                                                <Setter Property="Background" TargetName="Bd" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                            </Trigger>
                                            <!-- this handles the case where the items in the listbox are selected, but the listbox itself doesn't have focus -->
                                            <MultiTrigger>
                                                <MultiTrigger.Conditions>
                                                    <Condition Property="IsSelected" Value="true"/>
                                                    <Condition Property="Selector.IsSelectionActive" Value="false"/>
                                                </MultiTrigger.Conditions>
                                                <Setter Property="Background" TargetName="Bd" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}"/>
                                            </MultiTrigger>
                                            <Trigger Property="IsEnabled" Value="false">
                                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>
            </GroupBox>
        </DockPanel>
    </Grid>
</UserControl>
