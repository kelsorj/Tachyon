<Window x:Class="BioNex.HivePrototypePlugin.TeachpointTransformationDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:utils="clr-namespace:BioNex.Shared.Utils;assembly=Utils"
    xmlns:plugin="clr-namespace:BioNex.HivePrototypePlugin"
    Title="Teachpoint Transformation" Height="500" Width="800">

    <Window.Resources>
        <utils:StringFormatter x:Key="PositionFormatConverter" />
        <utils:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />
        <Style x:Key="LabelStyle" TargetType="Label">
            <Setter Property="HorizontalContentAlignment" Value="Right" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>
    </Window.Resources>
    
    <Grid>        
        <Grid.ColumnDefinitions>
            <ColumnDefinition></ColumnDefinition>
            <ColumnDefinition Width="Auto"></ColumnDefinition>
            <ColumnDefinition></ColumnDefinition>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition></RowDefinition>
            <RowDefinition></RowDefinition>
            <RowDefinition></RowDefinition>
        </Grid.RowDefinitions>
        
        <!-- LEFT HAND CONTROLS -->
        <DockPanel Grid.Column="0" Grid.RowSpan="3">
            <!-- parameters -->
            <Grid DockPanel.Dock="Top">
                <Grid.RowDefinitions>
                    <RowDefinition Height="27"></RowDefinition>
                    <RowDefinition Height="27"></RowDefinition>
                    <RowDefinition Height="27"></RowDefinition>
                    <RowDefinition Height="27"></RowDefinition>
                    <RowDefinition Height="27"></RowDefinition>
                    <RowDefinition Height="27"></RowDefinition>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"></ColumnDefinition>
                    <ColumnDefinition></ColumnDefinition>
                </Grid.ColumnDefinitions>
            
                <!-- labels -->
                <Label Grid.Row="0" Grid.Column="0" Style="{StaticResource LabelStyle}">From Device:</Label>
            
                <Label Grid.Row="1" Grid.Column="0" Style="{StaticResource LabelStyle}" >Remote Machine:</Label>
                <Label Grid.Row="2" Grid.Column="0" Style="{StaticResource LabelStyle}" >Remote Cart Barcode:</Label>
                <Label Grid.Row="3" Grid.Column="0" Style="{StaticResource LabelStyle}">Top left teachpoint:</Label>
                <Label Grid.Row="4" Grid.Column="0" Style="{StaticResource LabelStyle}">Number of shelves:</Label>
                <Label Grid.Row="5" Grid.Column="0" Style="{StaticResource LabelStyle}">Number of racks:</Label>
            
                <!-- values -->
                <ComboBox Grid.Row="0" Grid.Column="1" Margin="3" ItemsSource="{Binding FromDeviceNames}" IsSynchronizedWithCurrentItem="True" />
                <TextBox Grid.Row="0" Grid.Column="1" Margin="3" Text="{Binding FromDevice}" IsReadOnly="True" />
                <DockPanel Grid.Row="1" Grid.Column="1">
                    <Button DockPanel.Dock="Right" Margin="3" Command="{Binding ConnectRemoteAddressCommand}">Connect</Button>
                    <TextBox HorizontalContentAlignment="Right" Margin="3" ToolTip="Specify a remote machine name or ip address from which to retrieve teachpoints" Text="{Binding RemoteAddress}"></TextBox>
                </DockPanel>
                <TextBox Grid.Row="2" Grid.Column="1" Margin="3" Text="{Binding FromDeviceDockableBarcode, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding FromDeviceDockableEnabled}" />
                <ComboBox Grid.Row="3" Grid.Column="1" Margin="3" ItemsSource="{Binding FromTeachpointNames}" IsSynchronizedWithCurrentItem="True" />
                <ComboBox Grid.Row="4" Grid.Column="1" Margin="3" ItemsSource="{Binding NumberOfShelvesItems}" SelectedItem="{Binding NumberOfShelves}" IsSynchronizedWithCurrentItem="True" />
                <ComboBox Grid.Row="5" Grid.Column="1" Margin="3" ItemsSource="{Binding NumberOfRacksItems}" SelectedItem="{Binding NumberOfRacks}" IsSynchronizedWithCurrentItem="True" />
            </Grid>
        
            <!-- preview & execution -->
            <Grid DockPanel.Dock="Bottom">
                <GroupBox BorderBrush="DarkOrange" Header="Refinement Offsets">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" TextWrapping="Wrap" Margin="3">These are the calculated refinment offsets to be applied to the "To Device" teachpoint set:</TextBlock>
                        <ListView ItemsSource="{Binding RefinementOffsets}">
                            <ListView.View>
                                <GridView AllowsColumnReorder="False">
                                    <GridViewColumn Header="Name" Width="150" DisplayMemberBinding="{Binding Path=Name}" />
                                    <GridViewColumn Header="X" Width="50" DisplayMemberBinding="{Binding Path=X, Converter={StaticResource PositionFormatConverter}, ConverterParameter='\{0:0.000\}'}" />
                                    <GridViewColumn Header="Y" Width="50" DisplayMemberBinding="{Binding Path=Y, Converter={StaticResource PositionFormatConverter}, ConverterParameter='\{0:0.000\}'}" />
                                    <GridViewColumn Header="Z" Width="50" DisplayMemberBinding="{Binding Path=Z, Converter={StaticResource PositionFormatConverter}, ConverterParameter='\{0:0.000\}'}" />                                
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </DockPanel>
                </GroupBox>
            </Grid>
        </DockPanel>
        
        <!-- RIGHT HAND CONTROLS -->
        <DockPanel Grid.Column="2" Grid.RowSpan="3">
            <!-- parameters -->
            <Grid DockPanel.Dock="Top">
                <Grid.RowDefinitions>
                    <RowDefinition Height="27"></RowDefinition>
                    <RowDefinition Height="27"></RowDefinition>
                    <RowDefinition Height="27"></RowDefinition>
                    <RowDefinition Height="27"></RowDefinition>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"></ColumnDefinition>
                    <ColumnDefinition></ColumnDefinition>
                </Grid.ColumnDefinitions>

                <!-- labels -->
                <Label Grid.Row="0" Grid.Column="0" Style="{StaticResource LabelStyle}">To Device:</Label>
                <Label Grid.Row="1" Grid.Column="0" Style="{StaticResource LabelStyle}">Cart Barcode:</Label>
                <Label Grid.Row="2" Grid.Column="0" Style="{StaticResource LabelStyle}">Top left teachpoint:</Label>
                <Label Grid.Row="3" Grid.Column="0" Style="{StaticResource LabelStyle}">Preview:</Label>

                <!-- values -->
                <ComboBox Grid.Row="0" Grid.Column="1" Margin="3" ItemsSource="{Binding ToDeviceNames}" IsSynchronizedWithCurrentItem="True" />
                <!-- dockable id is just the cart barcode but named this way to be more generic for DockableStorage -->
                <TextBox Grid.Row="1" Grid.Column="1" Margin="3" Text="{Binding ToDeviceDockableBarcode, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding ToDeviceDockableEnabled}" />
                <ComboBox Grid.Row="2" Grid.Column="1" Margin="3" ItemsSource="{Binding ToTeachpointNames}" IsSynchronizedWithCurrentItem="True" />
                <StackPanel Grid.Row="3" Grid.Column="1" Margin="3" Orientation="Horizontal">
                    <RadioButton Margin="3" GroupName="Preview_Group" IsChecked="{Binding Path=ThePreviewType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static plugin:PreviewType.Offset}}" >Offset</RadioButton>
                    <RadioButton Margin="3" GroupName="Preview_Group" IsChecked="{Binding Path=ThePreviewType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static plugin:PreviewType.Interpolated}}" >Interpolated</RadioButton>
                    <RadioButton Margin="3" GroupName="Preview_Group" IsChecked="{Binding Path=ThePreviewType, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static plugin:PreviewType.Transformed}}" >Transformed</RadioButton>
                </StackPanel>
            </Grid>

            <!-- preview & execution -->
            <Grid DockPanel.Dock="Bottom">
                <GroupBox BorderBrush="DarkOrange" Header="Transformation Preview">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" TextWrapping="Wrap" Margin="3" Text="{Binding TransformationLabel}"></TextBlock>
                        <ListView ItemsSource="{Binding DisplayedTeachpoints}">
                            <ListView.View>
                                <GridView AllowsColumnReorder="False">
                                    <GridViewColumn Header="Name" Width="150" DisplayMemberBinding="{Binding Path=Name}" />
                                    <GridViewColumn Header="X" Width="50" DisplayMemberBinding="{Binding Path=X, Converter={StaticResource PositionFormatConverter}, ConverterParameter='\{0:0.000\}'}" />
                                    <GridViewColumn Header="Y" Width="50" DisplayMemberBinding="{Binding Path=Y, Converter={StaticResource PositionFormatConverter}, ConverterParameter='\{0:0.000\}'}" />
                                    <GridViewColumn Header="Z" Width="50" DisplayMemberBinding="{Binding Path=Z, Converter={StaticResource PositionFormatConverter}, ConverterParameter='\{0:0.000\}'}" />
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </DockPanel>
                </GroupBox>
            </Grid>
        </DockPanel>
        <Button Grid.Column="1" Grid.Row="1" Margin="3" Command="{Binding TransformTeachpointsCommand}">
            <Button.Content>
                <StackPanel Orientation="Vertical">
                    <Image Source="Images/right.png" Width="32" />
                    <Label>Transform</Label>
                </StackPanel>
            </Button.Content>
        </Button>
    </Grid>
</Window>
