<Window x:Class="BioNex.SynapsisPrototype.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:BioNex.SynapsisPrototype"
        mc:Ignorable="d"
        Height="1000"
        Width="800"
        Title="Synapsis"
        WindowStartupLocation="Manual" WindowState="Maximized"
        Loaded="Window_Loaded" Closing="Window_Closing" Closed="Window_Closed" KeyUp="Window_KeyUp">

    <!-- DataContext="{Binding Main, Source={StaticResource Locator}}" -->
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Skins/MainSkin.xaml" />
                <!-- ResourceDictionary Source="Skins/BioNexStyles.xaml" /-->
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <DockPanel x:Name="LayoutRoot">
            <Menu DockPanel.Dock="Top" Visibility="{Binding MenuVisibility}">
                <MenuItem ItemsSource="{Binding SystemSetupItems}" ItemContainerStyle="{StaticResource DiagnosticsMenuStyle}">
                    <MenuItem.Header>
                        <StackPanel Orientation="Vertical">
                            <Image Source="images/system_setup.png" Width="64" Height="64"/>
                            <ContentPresenter Content="System Tools" />
                        </StackPanel>
                    </MenuItem.Header>
                </MenuItem>
                <MenuItem ItemsSource="{Binding DiagnosticsPlugins}" ItemContainerStyle="{StaticResource DiagnosticsMenuStyle}">
                    <MenuItem.Header>
                        <StackPanel Orientation="Vertical">
                            <Image Source="images/diagnostics.png" Width="64" Height="64"/>
                            <ContentPresenter Content="Diagnostics" />
                        </StackPanel>
                    </MenuItem.Header>
                </MenuItem>
            </Menu>
            <StatusBar DockPanel.Dock="Bottom" Height="28">
                <StatusBar.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60" />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                        </Grid>
                    </ItemsPanelTemplate>
                </StatusBar.ItemsPanel>
                <StatusBarItem Grid.Column="0">
                    <TextBlock>Progress:</TextBlock>
                </StatusBarItem>
                <StatusBarItem Grid.Column="1">
                    <StackPanel Orientation="Horizontal">
                        <ProgressBar Value="{Binding ProgressBarValue}" Maximum="{Binding ProgressBarMaximum}" Width="400" Height="20"></ProgressBar>
                        <TextBlock Text="{Binding EstimatedTimeRemaining}" HorizontalAlignment="Left"/>
                    </StackPanel>
                </StatusBarItem>
            </StatusBar>
            <Grid DockPanel.Dock="Top" >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="{Binding SystemCheckPanelsWidth}" MaxWidth="200"/>
                    <ColumnDefinition Width="3*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="4*" />
                    <!-- grid splitter -->
                    <RowDefinition Height="Auto" />
                    <!-- logs -->
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <ListBox ItemsSource="{Binding SystemCheckPanels}" Grid.Column="0" Grid.Row="0" MinWidth="100" Padding="10" Visibility="{Binding SystemCheckPanelsVisibility}">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="{x:Type ListBoxItem}">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="HorizontalContentAlignment" Value="{Binding HorizontalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
                            <Setter Property="VerticalContentAlignment" Value="{Binding VerticalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
                            <Setter Property="Padding" Value="2,0,0,0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                        <Border x:Name="Bd" SnapsToDevicePixels="true" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="true">
                                                <Setter Property="Background" TargetName="Bd" Value="Transparent"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Vertical" />
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <!--
                    <ListBox.Background>
                        <RadialGradientBrush RadiusX="1" RadiusY="0.5" Center="1,1" GradientOrigin="0.5,1" Opacity="0.5">
                            <RadialGradientBrush.GradientStops>
                                <GradientStop Color="#FFFFFFFF" Offset="0"/>
                                <GradientStop Color="#FFC2C0C0" Offset="0.4"/>
                                <GradientStop Color="#FF909090" Offset="0.999"/>
                            </RadialGradientBrush.GradientStops>
                        </RadialGradientBrush>
                    </ListBox.Background>
                    -->
                </ListBox>
                <!-- bionex image -->
                <Image Source="Images\BioNex Logo.png" Grid.Column="0" Grid.Row="0" Opacity="0.2" VerticalAlignment="Bottom" Margin="5" />
                <DockPanel Grid.Column="1" Grid.Row="0">
                    <UniformGrid Rows="1" DockPanel.Dock="Bottom">
                        <Button Name="StartButton" Margin="3" Command="{Binding StartCommand}" ToolTip="{Binding StartCommandToolTip}" ToolTipService.ShowOnDisabled="True" MinHeight="50">Start</Button>
                        <Button Name="PauseResumeButton" Margin="3" Command="{Binding PauseResumeCommand}" ToolTip="{Binding PauseResumeCommandToolTip}" ToolTipService.ShowOnDisabled="True" Content="{Binding AbortPauseResumeSM.PauseResumeButtonText}" MinHeight="50">
                            <!-- I think this isn't working because I used databinding for Content, so this gets overridden -->
                            <Button.Effect>
                                <DropShadowEffect BlurRadius="{Binding PauseButtonGlowSize}" ShadowDepth="{Binding PauseButtonShadowDepth}" Color="Orange" />
                            </Button.Effect>
                        </Button>
                        <Button Name="AbortButton" Margin="3" Command="{Binding AbortCommand}" ToolTip="Aborts the run in progress" MinHeight="50">Abort</Button>
                    </UniformGrid>
                    <TabControl DockPanel.Dock="Top">
                        <TabItem MinHeight="50" x:Name="CustomerGUITab" Visibility="{Binding CustomerGUITabVisibility}"/>
                    </TabControl>
                </DockPanel>
                <GridSplitter Grid.ColumnSpan="2" Grid.Row="1" Height="5" ResizeDirection="Rows" HorizontalAlignment="Stretch" />
                <TabControl Grid.ColumnSpan="2" Grid.Row="2" TabStripPlacement="Bottom" SelectedIndex="{Binding SelectedTabIndex}">
                    <TabItem Header="Log">
                        <local:LogPanel x:Name="logpanel" />
                    </TabItem>
                    <TabItem Header="Errors" x:Name="ErrorTab">
                        <ListBox ItemsSource="{Binding Errors}" Width="Auto" x:Name="listbox_errors"/>
                    </TabItem>
                </TabControl>
            </Grid>
        </DockPanel>
        <Grid>
            <Rectangle x:Name="Overlay" Fill="DarkRed" Opacity="0.4" IsHitTestVisible="False" Visibility="{Binding InterlocksOverridden}" />
            <TextBlock FontSize="72" FontFamily="Arial Black" TextWrapping="Wrap" Visibility="{Binding InterlocksOverridden}" Text="{Binding InterlocksOverriddenText}" Foreground="Yellow" IsHitTestVisible="False" Opacity="{Binding ElementName=Overlay, Path=Opacity}" HorizontalAlignment="Center" VerticalAlignment="Center"></TextBlock>
        </Grid>
    </Grid>
</Window>
