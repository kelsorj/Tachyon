<UserControl x:Class="BioNex.Shared.GanttChart.UserControl1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:BioNex.Shared.GanttChart"
    Height="240" Width="320" SizeChanged="UserControl_SizeChanged" PreviewKeyUp="UserControl_KeyUp">
    
    <UserControl.Resources>
        <local:WidthFormatter x:Key="WidthConverter" />
    </UserControl.Resources>
    
    <!-- the layout root registers mouse event listeners -->
    <Grid x:Name="layoutRoot">
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="30" />
            <RowDefinition Height="30" />
        </Grid.RowDefinitions>
       
        <!-- Data Grid -->
        <DataGrid Grid.Row="0" ItemsSource="{Binding TaskList}" x:Name="grid_tasks"
         AutoGenerateColumns="False" SelectionMode="Single" CanUserDeleteRows="False" CanUserAddRows="False"
         CanUserReorderColumns="False" CanUserSortColumns="False" HeadersVisibility="None">
            <DataGrid.RowHeight>35</DataGrid.RowHeight>
            <DataGrid.Columns>
                <DataGridTextColumn x:Name="HeaderColumn" IsReadOnly="True" Header="Tip / Stage ID" FontWeight="Bold" MinWidth="100" Width="{Binding TaskColumnWidth, Mode=OneWayToSource}" Binding="{Binding Path=Name}" />
                <!-- Timing info -->
                <DataGridTemplateColumn x:Name="TaskColumn" Header="Timing" IsReadOnly="True" Width="3*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <!-- we are binding the listbox to a GanttTaskInfo object -->
                            <ItemsControl ItemsSource="{Binding Path=Tasks}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <local:GanttRowPanel MinDate="{Binding Path=Start}" MaxDate="{Binding Path=End}" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemContainerStyle>
                                    <!-- here we bind the Task's Start and End properties to the GanttRowPanel's StartDate and EndDate -->
                                    <Style>
                                        <Setter Property="local:GanttRowPanel.StartDate" Value="{Binding Start}"/>
                                        <Setter Property="local:GanttRowPanel.EndDate" Value="{Binding End}"/>
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                                <ItemsControl.ItemTemplate>
                                    <!-- since we're in the itemtemplate, everything here is databound to a Task object -->
                                    <DataTemplate>
                                        <DataTemplate.Triggers>
                                            <DataTrigger Binding="{Binding Path=Name}" Value="Aspirate">
                                                <Setter Property="ListBoxItem.Foreground" Value="Red"></Setter>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Path=Name}" Value="Dispense">
                                                <Setter Property="ListBoxItem.Foreground" Value="Green"></Setter>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Path=Name}" Value="Wash">
                                                <Setter Property="ListBoxItem.Foreground" Value="Blue"></Setter>
                                            </DataTrigger>
                                        </DataTemplate.Triggers>
                                        <Border BorderBrush="DarkBlue" BorderThickness="1" CornerRadius="3">
                                            <Border.Background>
                                                <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                                    <GradientStop Color="#AA407dce" Offset="0"/>
                                                    <GradientStop Color="#AA72d2e8" Offset=".75"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <TextBlock Text="{Binding Path=Name}" HorizontalAlignment="Center" VerticalAlignment="Center" ToolTip="{Binding Path=Description}"/>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
        <!-- time -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="{Binding ElementName=HeaderColumn, Path=Width, Converter={StaticResource WidthConverter}}" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="1" HorizontalAlignment="Left" Text="{Binding StartText}" />
            <TextBlock Grid.Column="1" HorizontalAlignment="Right" Text="{Binding EndText}" />
            <TextBlock Grid.Column="1" HorizontalAlignment="Center" Text="{Binding DebugText}" />
        </Grid>
        <!-- slider bar -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="30" />
                <ColumnDefinition />
                <ColumnDefinition Width="30" />
            </Grid.ColumnDefinitions>
            <Button Grid.Column="0" Margin="3">&lt;&lt;</Button>
            <Slider Grid.Column="1" VerticalAlignment="Center" Margin="3" Value="{Binding SliderValue}" Minimum="{Binding SliderMin}" Maximum="{Binding SliderMax}" IsSnapToTickEnabled="True" IsMoveToPointEnabled="True"></Slider>
            <Button Grid.Column="2" Margin="3">&gt;&gt;</Button>
        </Grid>
    </Grid>
</UserControl>
